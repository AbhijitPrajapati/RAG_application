<!DOCTYPE html>
<html lang='en'>
<head>
    <meta charset='UTF-8' />
    <title>RAG App</title>
    <style>
        body { font-family: sans-serif; padding: 2rem; }
        input[type='text'] { width: 300px; padding: 0.5rem; }
        button { padding: 0.5rem 1rem; margin-left: 1rem; }
        #response { margin-top: 2rem; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h2>Ask a question:</h2>

    <input type='text' id='query_input' placeholder='Enter your question' />
    <button id='query-submit'>Submit</button>

    <div id='response'></div>

    <h2>Upload a .txt File</h2>
    <form id='upload-form'>
        <input type='file' name='files' accept='.txt' multiple required>
        <button type='submit'>Upload</button>
    </form>

    <div id='upload-result'></div>

    <script>
        document.getElementById('query-submit').addEventListener('click', async () => {
            const query = document.getElementById('query_input').value;

            const responseDiv = document.getElementById('response');
            responseDiv.innerText = 'Thinking...';

            try {
                const res = await fetch('http://localhost:8000/query', {
                    method: 'POST',
                    headers: {
                    'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ query: query })
                });

                const data = await res.json();

                responseDiv.innerText = data.response || 'No answer returned.';
            } catch (err) {
                console.error(err);
                responseDiv.innerText = 'Error: ' + err.message;
            }
        });

        document.getElementById('upload-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const form = e.target;
            const formData = new FormData();

            const files = form.querySelector('input[type="file"]').files;

            for (let i = 0; i < files.length; i++) {
                formData.append('files', files[i]);
            }

            const res = await fetch('http://localhost:8000/upload', {
                method: 'POST',
                body: formData
            });

            const result = await res.json();
            
            document.getElementById('upload-result').innerText = JSON.stringify(result, null, 2);
        });


    </script>
</body>
</html>